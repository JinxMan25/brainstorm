<!DOCTYPE html>
<meta charset="utf-8">
<script src="http://d3js.org/d3.v2.js?2.9.1"></script>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script src="https://rawgithub.com/vijithassar/d3textwrap/master/d3textwrap.v0.js" type="text/javascript"></script>
<body>
<div id="addnode">
  <h2>Microsoft</h2>
  <h3 id="target">
  <h3>
    <h3 id="source">
    </h3>
</div>
<script>

// http://blog.thomsonreuters.com/index.php/mobile-patent-s-graphic-of-the-day/
var links = [
  {"source": "Microsoft", "target": "Amazon", "target_body": "1", "source_body": "a"},
  {"source": "Microsoft", "target": "HTC", "target_body": "2", "source_body": ""},
{"source": "HTC", "target": "Whatever", "target_body":"Lorem Ipsum is simply dummy textt lkjt lkjt lkjtlkjt lkj lkjasldf yeah this is very good I mean now i can proceed with everything else. Which is definetly great!", "source_body": ""},
  {"source": "Samsung", "target": "Apple", "target_body": "3", "source_body": "c"},
  {"source": "Motorola", "target": "Apple", "target_body": "4", "source_body": "b"},
  {"source": "Apple", "target": "Nokias", "target_body": "5", "source_body": "b"},
  {"source": "HTC", "target": "Apple", "target_body": "6", "source_body": "b"},
  {"source": "Kodak", "target": "Apple", "target_body": "7", "source_body": "b"},
  {"source": "Microsoft", "target": "Barnes & Noble", "target_body": "8", "source_body": "b"},
  {"source": "Microsoft", "target": "Foxconn", "target_body": "9", "source_body": "b"},
  {"source": "Apple", "target": "HTC", "target_body": "10", "source_body": "b"},
  {"source": "Microsoft", "target": "Inventec", "target_body": "11", "source_body": "b"},
  {"source": "Samsung", "target": "Kodak", "target_body": "12", "source_body": "b"},
  {"source": "LG", "target": "Kodak", "target_body": "13", "source_body": "b"},
  {"source": "RIM", "target": "Kodak", "target_body": "14", "source_body": "b"},
  {"source": "Sony", "target": "LG", "target_body": "15", "source_body": "b"},
  {"source": "Kodak", "target": "LG", "target_body": "16", "source_body": "b"},
  {"source": "Apple", "target": "Nokia", "target_body": "17", "source_body": "b"},
  {"source": "Qualcomm", "target": "Nokia", "target_body": "18", "source_body": "b"},
  {"source": "MyTime", "target": "Android", "target_body":"19", "source_body": "c"},
  {"source": "MyTime", "target": "IOS", "target_body":"20", "source_body": "b"},
  {"source": "Apple", "target": "Motorola", "target_body": "21", "source_body": "b"},
  {"source": "Microsoft", "target": "Motorola", "target_body": "22", "source_body": "b"},
  {"source": "Motorola", "target": "Microsoft", "target_body": "23", "source_body": "b"},
  {"source": "ZTE", "target": "Huawei", "target_body": "24", "source_body": "bB"},
  {"source": "ZTE", "target": "Ericsson", "target_body": "25", "source_body": ""},
  {"source": "Kodak", "target": "Samsung", "target_body": "26", "source_body": "b"},
  {"source": "Apple", "target": "Samsung", "target_body": "27", "source_body": "b"},
  {"source": "Kodak", "target": "RIM", "target_body": "28", "source_body": "b"},
  {"source": "Nokia", "target": "Qualcomm", "target_body": "29", "source_body": "b"}
];

var nodes = {};

// Compute the distinct nodes from the links.
links.forEach(function(link) {
  link.source = nodes[link.source] || (nodes[link.source] = {name: link.source, target: link.target, body: link.source_body});
  link.target = nodes[link.target] || (nodes[link.target] = {name: link.target, source: link.source.name, body: link.target_body});
});

var width = 900,
    height = 600;

var force = d3.layout.force()
    .nodes(d3.values(nodes))
    .links(links)
    .size([width, height])
    .linkDistance(150)
    .charge(-600)
    .on("tick", tick)
    .start();

var svg = d3.select("body").append("svg")
    .attr("height", height)
    .attr("width", width);
var link = svg.selectAll(".link")
    .data(force.links())
  .enter().append("line")
    .attr("class", "link");

var node = svg.selectAll(".node")
    .data(force.nodes())
  .enter().append("g")
    .attr("class", "node")
    .on("mouseover", mouseover)
    .on("mouseout", mouseout)
    .call(force.drag)
    .on("click", click);
    

node.append("circle")
.attr("r", function(d){
    if (d.weight == "1"){
    return 28;
    }else if (d.weight == "2"){
    return 17.5 * d.weight;
    }else if (d.weight == "3"){
      return 13 * d.weight;
    }else if (d.weight == "4"){
      return 11 * d.weight;
    }else if (d.weight == "5"){
      return 10* d.weight;
    }else if (d.weight == "6"){
      return 7 * d.weight;
    }else if (d.weight >= "7"){
      return 6.5 * d.weight;
    }
      })
    .attr("fill","grey")
    .attr("stroke","black")
    .attr("stroke-width",1.5)
    .attr("data-target", function(d){
        return d.target;
        })
    .attr("data-name", function(d){
        return d.name;
        })
    .attr("data-source", function(d){
        return d.source;
        });
var bounds = {
    x : 50,
    y :50,
    width : 100,
    height : 100,
  };
node.append("text")
    .attr("text-anchor", "middle")
    .text(function(d) { return d.name; })
    .attr("dy", ".20em")
    .attr("class", "node_title")
    .attr("font-size",12);
node.append("text")
    .attr("text-anchor", "middle")
    .attr("height", "10px")
    .attr("width", "10px")
    .text(function(d) { 
      return d.body; })
    .attr("dy", "0.1em")
    .attr("class","node_body")
    .attr("font-size", 12)
    .call(wrap, 290);

  //$("circle").click(function(){
    //  alert ($(this).data("name"));
      //});
function wrap(text, width) {
  text.each(function() {
    var text = d3.select(this),
        words = text.text().split(/\s+/).reverse(),
        word,
        line = [],
        lineNumber = 0,
        lineHeight = 1.1, // ems
        y = text.attr("y"),
        dy = parseFloat(text.attr("dy")) || 0,
        tspan = text.text(null).append("tspan").attr("x", 0).attr("y", y).attr("dy", dy + "em");
    while (word = words.pop()) {
      line.push(word);
      tspan.text(line.join(" "));
      if (tspan.node().getComputedTextLength() > width) {
        line.pop();
        tspan.text(line.join(" "));
        line = [word];
        tspan = text.append("tspan").attr("x", 0).attr("y", y).attr("dy", ++lineNumber * lineHeight + dy + "em").text(word);
      }
    }
  });
}
 
$("circle").dblclick(function(){
    var node = $(this).data("name");
    $("#addnode h2").text(node);
    $("#addnode").addClass('translate');  
      });

$("circle").hover(function(){
    if($(this).data("target")){
  var target = $(this).data("target");
  $("#target").text("Target: " + target);
  } else {
    $("#target").text("Target: None");
    //var source = $(this).data("source");
  }
  if($(this).data("source")){
    var source = $(this).data("source");
    $("#source").text("Source: " + source);
  } else {
    $("#source").text("Source: self");
    }
  var node = $(this).data("name");
  $("#addnode h2").text(node);
  $("#addnode").addClass('translate');
  },
  function(){
  $("#addnode").removeClass('translate');
  });

function tick() {
  link
      .attr("x1", function(d) { return d.source.x; })
      .attr("y1", function(d) { return d.source.y; })
      .attr("x2", function(d) { return d.target.x; })
      .attr("y2", function(d) { return d.target.y; });

  node
      .attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; });
}

function mouseover() {
  
  if( d3.select(this).select("circle").attr("r") < 100){
  d3.select(this).select("text").transition()
    .style("font-size","25px")
    .ease("elastic")
    .duration(1000);
  d3.select(this).select("circle").transition()
      .ease("elastic")
      .duration(1000)
      .attr("r",function(d){
if (d.weight == "1"){
    return 28*2;
    }else if (d.weight == "2"){
    return 17.5 * d.weight * 1.5;
    }else if (d.weight == "3"){
      return 13 * d.weight*1.5;
    }else if (d.weight == "4"){
      return 11 * d.weight*1.5;
    }else if (d.weight == "5"){
      return 10* d.weight*1.5;
    }else if (d.weight == "6"){
      return 7 * d.weight*1.5;
    }else if (d.weight >= "7"){
      return 5 * d.weight*1.5;
    }
});
  }
}
function click(){
  
  if( d3.select(this).select("circle").attr("r") > 100 ){
    $("#addnode").removeClass("translate");
    d3.select(this).select("circle").transition()
      .duration(1000)
      .attr("r", function(d){
      if (d.weight == "1"){
      return 28;
      }else if (d.weight == "2"){
      return 17.5 * d.weight;
      }else if (d.weight == "3"){
        return 13 * d.weight;
      }else if (d.weight == "4"){
        return 11 * d.weight;
      }else if (d.weight == "5"){
        return 10* d.weight;
      }else if (d.weight == "6"){
        return 7 * d.weight;
      }else if (d.weight >= "7"){
        return 6.5 * d.weight;
      }
        })
      .attr("stroke","black")
      .attr("stroke-width",1.5);
    d3.select(this).select('.node_body').transition()
      .ease("elastic")
      .duration(500)
      .style("display", "none")
    d3.selectAll(".node_title").transition()
      .ease("elastic")
      .duration(1000)
      .style("font-size", "15px")
      .attr("dy", ".20em");
      
  } else {
  $("#addnode").removeClass("translate");  
  d3.selectAll("circle").transition()
    .duration(1000)
    .attr("r", function(d){
    if (d.weight == "1"){
    return 28;
    }else if (d.weight == "2"){
    return 17.5 * d.weight;
    }else if (d.weight == "3"){
      return 13 * d.weight;
    }else if (d.weight == "4"){
      return 11 * d.weight;
    }else if (d.weight == "5"){
      return 10* d.weight;
    }else if (d.weight == "6"){
      return 7 * d.weight;
    }else if (d.weight >= "7"){
      return 6.5 * d.weight;
    }
      })
    .attr("stroke-width", 1.5)
    .attr("stroke", "black");
  d3.selectAll("text").transition()
    .duration(750)
    .style("font-size", "15px")
    .ease("elastic")
    .attr("dy",".20em");
  d3.select(this).select("circle").transition()
    .ease("elastic")
    .duration(2500)
    .attr("r", 250)
    .style("z-index","200")
    .attr("stroke-width", 10)
    .attr("stroke", "purple");
  d3.select(this).select("text").transition()
    .duration(2500)
    .style("font-size", "72px")
    .ease("elastic")
    .attr("dy", "-100px");
  d3.select(this).select('.node_body').transition()
    .duration(750)
    .ease("elastic")
    .style("font-size", 25)
    .attr("dy", "0px");

  }
}

$("circle").click(function (){
    $("node_body").show();
    });

function mouseout() {
  if( d3.select(this).select("circle").attr("r") < 90){
  d3.select(this).select("text").transition()
    .style("font-size", "15px")
    .ease("elastic")
    .duration(750);
  d3.select(this).select("circle").transition()
      .ease("elastic")
      .duration(750)
      .attr("r",function(d){
if (d.weight == "1"){
    return 28;
    }else if (d.weight == "2"){
    return 17.5 * d.weight;
    }else if (d.weight == "3"){
      return 13 * d.weight;
    }else if (d.weight == "4"){
      return 11 * d.weight;
    }else if (d.weight == "5"){
      return 10* d.weight;
    }else if (d.weight == "6"){
      return 7 * d.weight;
    }else if (d.weight >= "7"){
      return 6.5 * d.weight;
    }
});
  }
  }

</script>
